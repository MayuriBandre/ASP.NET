
@{
    ViewBag.Title = "Index";
    Layout = "";
}
<html>
<head>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>

    <!-- Additional scripts -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
    <style>
        .divider-text {
            position: relative;
            text-align: center;
            margin-top: 15px;
            margin-bottom: 15px;
        }

            .divider-text span {
                padding: 7px;
                font-size: 12px;
                position: relative;
                z-index: 2;
            }
            .td{
                text-center;
            }

            .divider-text:after {
                content: "";
                position: absolute;
                width: 100%;
                border-bottom: 1px solid #ddd;
                top: 55%;
                left: 0;
                z-index: 1;
            }

       
    </style>
</head>
<body>

    <div class="card"style="margin:50px; border-color:black" >
        <div class="card-body">

            <h2 class="text-center">Registration Form</h2>


            <button type="button" class="btn btn-outline-secondary" style=" margin:20px;"data-toggle="modal" data-target="#userModal">
                Add User
            </button>


            <table class="table table-striped">
                <thead  class="table-light">
                    <tr>

                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>

                        <th>Actions</th>

                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>


            <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="card bg-light">
                            <article class="card-body mx-auto" style="max-width: 400px;">
                                <h4 class="card-title mt-3 text-center">Create Account</h4>

                                <form>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-user"></i> </span>
                                        </div>
                                        <input name="" id="name" class="form-control" placeholder="Full name" type="text">

                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-envelope"></i> </span>
                                        </div>
                                        <input name="" id="email" class="form-control" placeholder="Email address" type="email">
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-phone"></i> </span>
                                        </div>
                                        <input name="" id="phone" class="form-control" placeholder="Phone number" type="number">

                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-home"></i> </span>
                                        </div>
                                        <input name="address" id="address" class="form-control" placeholder="Address" type="text">
                                    </div>


                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-globe"></i> </span>
                                        </div>
                                        <select name="state" class="form-control" id="state">
                                            <option value="" selected disabled>Select State</option>

                                        </select>
                                    </div>

                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-building"></i> </span>
                                        </div>
                                        <select name="city" class="form-control" id="city">
                                            <option value="" selected disabled>Select City</option>

                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="agreeCheckbox">
                                            <label class="custom-control-label" for="agreeCheckbox">Agree?</label>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary btn-block" id="submitButton">Submit</button>
                                        <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">Cancel</button>
                                    </div>

                                </form>
                            </article>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="editUserModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="card bg-light">
                            <article class="card-body mx-auto" style="max-width: 400px;">
                                <h4 class="card-title mt-3 text-center">Edit User</h4>
                                <form>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-user"></i> </span>
                                        </div>
                                        <input id="ename" class="form-control" placeholder="Full name" type="text">
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-envelope"></i> </span>
                                        </div>
                                        <input id="eemail" class="form-control" placeholder="Email address" type="email">
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-phone"></i> </span>
                                        </div>
                                        <input id="ephone" class="form-control" placeholder="Phone number" type="number">
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-home"></i> </span>
                                        </div>
                                        <input id="eaddress" class="form-control" placeholder="Address" type="text">
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-globe"></i> </span>
                                        </div>
                                        <select name="estate" class="form-control" id="estate" required>
                                            <option value="" selected disabled>Select State</option>
                                        </select>
                                    </div>
                                    <div class="form-group input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-building"></i> </span>
                                        </div>
                                        <select name="ecity" class="form-control" id="ecity" required>
                                            <option value="" selected disabled>Select City</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-primary btn-block" id="editsubmitButton">Submit</button>
                                        <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">Cancel</button>
                                    </div>
                                </form>
                            </article>
                        </div>
                    </div>
                </div>
            </div>

        </div>

</div>

    <script>
            var users;
            $(document).ready(function () {
                $('#submitButton').prop('disabled', true);


                $('#agreeCheckbox').change(function () {
                    $('#submitButton').prop('disabled', !$(this).prop('checked'));
                });



                $('#submitButton').click(function (event) {
                    event.preventDefault();
                    var name = $("#name").val();
                    var email = $("#email").val();
                    var phone = $("#phone").val();
                    var address = $("#address").val();
                    var state = $("#state").val();
                    var city = $("#city").val();

                    if (phone.length > 10) {
                        alert("enter valid number");
                        return;
                    }
                    if (name === "" || email === "" || phone === "" || address === "" || (state === "" || state == null) || (city === "" || city == null)) {
                        alert("Please fill in all required fields and agree to the terms.");
                        return;
                    }

                    submitForm();
                });
             
                fetchStates();
                $('#editsubmitButton').click(function (event) {
                    event.preventDefault();
                    var name = $("#ename").val();
                    var email = $("#eemail").val();
                    var phone = $("#ephone").val();
                    var address = $("#eaddress").val();
                    var state = $("#estate").val();
                    var city = $("#ecity").val();
                    if (phone.length > 10) {
                        alert("enter valid number");
                        return;
                    }

                    if (name === "" || email === "" || phone === "" || address === "" || (state === "" || state == null) || (city === "" || city == null)) {
                        alert("Please fill in all required fields and agree to the terms.");
                        return;
                    }

                    editsubmitForm();
                });
            });


            function fetchStates() {

                $.ajax({
                    url: '/User/GetStates',
                    type: 'GET',
                    dataType: 'json',
                    success: function (states) {

                        updateStateDropdown(states);
                        editupdateStateDropdown(states);

                    },
                    error: function (error) {
                        console.error('Error fetching states:', error);
                    }
                });
            }


            debugger;

            function fetchCities(stateId) {
                $.ajax({
                    url: '/User/GetCities',
                    type: 'GET',
                    data: { stateId: stateId },
                    dataType: 'json',
                    success: function (cities) {
                        console.log(cities)
                        updateCityDropdown(cities);
                        updateCityDropdownedit(cities);
                    },
                    error: function (error) {
                        console.error('Error fetching cities:', error);
                    }
                });
            }
            function updateStateDropdown(states) {
                var stateDropdown = $('#state');
                stateDropdown.empty();
                stateDropdown.append('<option value="" selected disabled>Select State</option>');

                $.each(states, function (index, state) {
                    stateDropdown.append('<option value="' + state.StateId + '">' + state.StateName + '</option>');
                });

                $('#state').change(function () {
                    var selectedStateId = $(this).val();
                    fetchCities(selectedStateId, function () {
                        fetchUsers();
                    });
                });
            }


            function updateCityDropdown(cities) {
                var cityDropdown = $('#city');
                cityDropdown.empty();
                cityDropdown.append('<option value="" selected disabled>Select City</option>');

                $.each(cities, function (index, city) {

                    cityDropdown.append('<option value="' + city.CityId + '" >' + city.CityName + '</option>');
                });
            }


            function submitForm() {

                var name = $('#name').val();
                var email = $('#email').val();
                var phone = $('#phone').val();
                var address = $('#address').val();
                var stateId = $('#state').val();
                var cityId = $('#city').val()
                $.ajax({
                    url: '/User/InsertUser',
                    type: 'GET',
                    data: {
                        name: name,
                        email: email,
                        phone: phone,
                        address: address,
                        stateId: stateId,
                        cityId: cityId
                    },
                    success: function (response) {
                        alert(" add successfully")
                        location.reload();
                        console.log('Data inserted successfully:', response);
                    },
                    error: function (error) {

                        console.error('Error inserting data:', error);
                    }
                });
            }

            function fetchUsers() {
                $.ajax({
                    url: '/User/GetUsers',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        updateTable(data);
                    },
                    error: function (error) {
                        console.error('Error fetching user data:', error);
                    }
                });
            }






            function updateTable(userData) {
                users = userData;
                var tableBody = $('#userTableBody');
                tableBody.empty();

                $.each(users, function (index, user) {
                    var row = $('<tr>');
                    row.append('<td>' + user.Name + '</td>');
                    row.append('<td>' + user.Email + '</td>');
                    row.append('<td>' + user.Phone + '</td>');
                    tableBody.append(row);

                    row.append('<td>' +
                        '<button class="btn btn-outline-secondary"style="margin-right:20px;" onclick="editUser(' + user.Id + ')">Edit</button>' +
                        '<button class="btn btn-outline-secondary" onclick="deleteUser(' + user.Id + ')">Delete</button>' +
                        '</td>');


                });
            }
            function deleteUser(userId) {
                var confirmation = confirm("Are you sure you want to delete this user?");

                if (confirmation) {
                    $.ajax({
                        url: '/User/DeleteUser?id=' + userId,
                        type: 'GET',
                        dataType: 'json',
                        success: function (response) {

                            console.log('User deleted:', response);
                            setTimeout(function () {
                                location.reload();
                            }, 500);
                        },
                        error: function (error) {

                            console.error('Error deleting user:', error);
                        }
                    });
                }
            }
            function editupdateStateDropdown(states) {
                var stateDropdown = $('#estate');
                stateDropdown.empty();
                stateDropdown.append('<option value="" selected disabled>Select State</option>');

                $.each(states, function (index, state) {
                    stateDropdown.append('<option value="' + state.StateId + '">' + state.StateName + '</option>');
                });


                $('#estate').change(function () {
                    var selectedStateId = $(this).val();
                    fetchCities(selectedStateId, function () {
                        fetchUsers();
                    });
                });
            }
            function updateCityDropdownedit(cities) {
                var cityDropdown = $('#ecity'); 
                cityDropdown.empty();
                cityDropdown.append('<option value="" selected disabled>Select City</option>');

                $.each(cities, function (index, city) {
                    cityDropdown.append('<option value="' + city.CityId + '">' + city.CityName + '</option>');
                });
            }





            function editsubmitForm(userId) {
                $.ajax({
                    url: '/User/EditUser',
                    type: 'Get',
                    data: {
                        Id: userId,
                        name: $('#ename').val(),
                        email: $('#eemail').val(),
                        phone: $('#ephone').val(),
                        address: $('#eaddress').val(),
                        stateId: $('#estate').val(),
                        cityId: $('#ecity').val()
                    },
                    success: function (response) {
                        alert("edit sucessfully");
                        location.reload();
                        console.log(response);
                    },
                    error: function (error) {
                        console.error('Error updating user:', error);
                    }
                });
            }
            debugger;
            function editUser(userId) {
                var user = users.find(function (u) {
                    return u.Id === userId;
                });

                if (user) {
                    $('#editUserModal').modal('show');
                    $('#ename').val(user.Name);
                    $('#eemail').val(user.Email);
                    $('#ephone').val(user.Phone);
                    $('#eaddress').val(user.Address);
                    $('#estate').val(user.StateId);
                    $('#ecity').val(user.CityId);

                  
                    $('#editsubmitButton').click(function () {
                        editsubmitForm(user.Id);
                    });
                } else {
                    console.error('User not found with ID: ' + userId);
                }
            }

            fetchUsers();
    </script>
</body>
</html>
